"use strict";(self.webpackChunkaccelerator_2=self.webpackChunkaccelerator_2||[]).push([[316],{7316:(H,x,c)=>{c.r(x),c.d(x,{SchedulerModule:()=>J});var d=c(177),a=c(4341),f=c(7046),t=c(4438),_=c(8010);const k="apwu_scheduler_meetings_v1";let h=(()=>{class n{listAll(){return g().sort((e,i)=>e.start.localeCompare(i.start))}listForUser(e){return this.listAll().filter(i=>i.participants.includes(e)||i.createdBy===e)}upcomingForUser(e,i=8){const r=(new Date).toISOString();return this.listForUser(e).filter(s=>"scheduled"===s.status&&s.start>=r).sort((s,o)=>s.start.localeCompare(o.start)).slice(0,i)}create(e){const i=g();if(!e.title?.trim())return{ok:!1,error:"Title is required."};if(!e.start||!e.end)return{ok:!1,error:"Start and end are required."};if(new Date(e.end)<=new Date(e.start))return{ok:!1,error:"End must be after start."};if(!e.participants?.length)return{ok:!1,error:"Select at least one participant."};if(i.find(u=>"scheduled"===u.status&&b(e.start,e.end,u.start,u.end)&&u.participants.some(m=>e.participants.includes(m))))return{ok:!1,error:"Time conflict with another meeting for a participant."};const s=(new Date).toISOString(),o={...e,id:crypto.randomUUID(),status:"scheduled",createdAt:s,updatedAt:s};return i.push(o),F(i),{ok:!0,meeting:o}}update(e,i){const r=g(),s=r.findIndex(m=>m.id===e);if(s<0)return{ok:!1,error:"Meeting not found."};const o={...r[s],...i,updatedAt:(new Date).toISOString()};return new Date(o.end)<=new Date(o.start)?{ok:!1,error:"End must be after start."}:(i.start||i.end||i.participants)&&r.find(p=>p.id!==e&&"scheduled"===p.status&&b(o.start,o.end,p.start,p.end)&&p.participants.some(q=>o.participants.includes(q)))?{ok:!1,error:"Time conflict with another meeting."}:(r[s]=o,F(r),{ok:!0,meeting:o})}cancel(e){const i=g(),r=i.findIndex(s=>s.id===e);return r<0?{ok:!1,error:"Meeting not found."}:(i[r].status="cancelled",i[r].updatedAt=(new Date).toISOString(),F(i),{ok:!0})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function g(){try{const n=localStorage.getItem(k);return n?JSON.parse(n):[]}catch{return[]}}function F(n){localStorage.setItem(k,JSON.stringify(n))}function b(n,l,e,i){return new Date(n)<new Date(i)&&new Date(e)<new Date(l)}function y(n,l){1&n&&(t.j41(0,"div",19),t.EFF(1," Title is required (min 3 chars). "),t.k0s())}function I(n,l){if(1&n){const e=t.RV6();t.j41(0,"label",20)(1,"input",21),t.bIt("change",function(r){const s=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.onToggleParticipant(s.email,r))}),t.k0s(),t.j41(2,"span"),t.EFF(3),t.j41(4,"span",22),t.EFF(5),t.k0s()()()}if(2&n){const e=l.$implicit,i=t.XpG();t.R7$(),t.Y8G("value",e.email)("checked",i.isSelected(e.email)),t.R7$(2),t.SpI(" ",e.name," "),t.R7$(2),t.SpI("(",e.email,")")}}function S(n,l){if(1&n&&(t.j41(0,"div",23),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.error," ")}}function $(n,l){if(1&n&&(t.j41(0,"div",24),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.success," ")}}let C=(()=>{class n{constructor(e,i,r){this.fb=e,this.auth=i,this.scheduler=r,this.created=new t.bkB,this.updated=new t.bkB,this.me=null,this.users=[],this.error="",this.success="",this.form=this.fb.group({id:[""],title:["",[a.k0.required,a.k0.minLength(3)]],description:[""],date:["",a.k0.required],startTime:["",a.k0.required],endTime:["",a.k0.required],location:[""],onlineLink:[""],participants:[[]]})}ngOnInit(){this.auth.user$.subscribe(e=>{this.me=e,this.users=this.auth.listUsers(),e&&0===this.participantsValue().length&&this.form.controls.participants.setValue([e.email])})}participantsValue(){return this.form.controls.participants.value??[]}isSelected(e){return this.participantsValue().includes(e)}onToggleParticipant(e,i){const r=i.target?.checked??!1,s=[...this.participantsValue()];if(r)s.includes(e)||s.push(e);else{const o=s.indexOf(e);o>=0&&s.splice(o,1)}this.form.controls.participants.setValue(s)}submit(){if(this.error="",this.success="",!this.me)return void(this.error="Not authenticated.");if(this.form.invalid)return void this.form.markAllAsTouched();const e=this.form.getRawValue(),i=v(e.date,e.startTime),r=v(e.date,e.endTime),s={title:e.title.trim(),description:e.description?.trim()||"",start:i,end:r,location:e.location?.trim()||null,onlineLink:e.onlineLink?.trim()||null,participants:this.participantsValue().length?this.participantsValue():[this.me.email],createdBy:this.me.email},o=this.scheduler.create(s);o.ok?(this.success="Meeting scheduled.",this.form.reset({participants:[this.me.email]}),this.created.emit()):this.error=o.error||"Failed to create meeting."}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(a.ok),t.rXU(_.u),t.rXU(h))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-meeting-form"]],outputs:{created:"created",updated:"updated"},decls:45,vars:5,consts:[[1,"rounded-xl","border","p-4"],[1,"text-lg","font-semibold","mb-3"],["novalidate","",1,"grid","gap-4","md:grid-cols-2",3,"ngSubmit","formGroup"],[1,"md:col-span-2"],[1,"block","text-sm","font-medium","mb-1"],["type","text","formControlName","title",1,"w-full","border","rounded-lg","px-3","py-2"],["class","text-sm text-red-600",4,"ngIf"],["type","date","formControlName","date",1,"w-full","border","rounded-lg","px-3","py-2"],["type","time","formControlName","startTime",1,"w-full","border","rounded-lg","px-3","py-2"],["type","time","formControlName","endTime",1,"w-full","border","rounded-lg","px-3","py-2"],["type","text","formControlName","location","placeholder","e.g., Room A",1,"w-full","border","rounded-lg","px-3","py-2"],["type","url","formControlName","onlineLink","placeholder","https://\u2026",1,"w-full","border","rounded-lg","px-3","py-2"],[1,"grid","sm:grid-cols-2","md:grid-cols-3","gap-2"],["class","flex items-center gap-2 text-sm border rounded-lg p-2",4,"ngFor","ngForOf"],[1,"text-xs","text-gray-500","mt-1"],["rows","3","formControlName","description",1,"w-full","border","rounded-lg","px-3","py-2"],["class","md:col-span-2 rounded-md border border-red-200 bg-red-50 p-3 text-red-700",4,"ngIf"],["class","md:col-span-2 rounded-md border border-green-200 bg-green-50 p-3 text-green-800",4,"ngIf"],["type","submit",1,"rounded-lg","bg-black","text-white","px-4","py-2"],[1,"text-sm","text-red-600"],[1,"flex","items-center","gap-2","text-sm","border","rounded-lg","p-2"],["type","checkbox",3,"change","value","checked"],[1,"text-gray-500"],[1,"md:col-span-2","rounded-md","border","border-red-200","bg-red-50","p-3","text-red-700"],[1,"md:col-span-2","rounded-md","border","border-green-200","bg-green-50","p-3","text-green-800"]],template:function(i,r){1&i&&(t.j41(0,"div",0)(1,"h2",1),t.EFF(2,"Schedule a meeting"),t.k0s(),t.j41(3,"form",2),t.bIt("ngSubmit",function(){return r.submit()}),t.j41(4,"div",3)(5,"label",4),t.EFF(6,"Title"),t.k0s(),t.nrm(7,"input",5),t.DNE(8,y,2,0,"div",6),t.k0s(),t.j41(9,"div")(10,"label",4),t.EFF(11,"Date"),t.k0s(),t.nrm(12,"input",7),t.k0s(),t.j41(13,"div")(14,"label",4),t.EFF(15,"Start"),t.k0s(),t.nrm(16,"input",8),t.k0s(),t.j41(17,"div")(18,"label",4),t.EFF(19,"End"),t.k0s(),t.nrm(20,"input",9),t.k0s(),t.j41(21,"div")(22,"label",4),t.EFF(23,"Location"),t.k0s(),t.nrm(24,"input",10),t.k0s(),t.j41(25,"div")(26,"label",4),t.EFF(27,"Online link"),t.k0s(),t.nrm(28,"input",11),t.k0s(),t.j41(29,"div",3)(30,"label",4),t.EFF(31,"Participants"),t.k0s(),t.j41(32,"div",12),t.DNE(33,I,6,4,"label",13),t.k0s(),t.j41(34,"p",14),t.EFF(35,"You\u2019re automatically included when creating a meeting."),t.k0s()(),t.j41(36,"div",3)(37,"label",4),t.EFF(38,"Description"),t.k0s(),t.nrm(39,"textarea",15),t.k0s(),t.DNE(40,S,2,1,"div",16)(41,$,2,1,"div",17),t.j41(42,"div",3)(43,"button",18),t.EFF(44,"Create meeting"),t.k0s()()()()),2&i&&(t.R7$(3),t.Y8G("formGroup",r.form),t.R7$(5),t.Y8G("ngIf",r.form.controls.title.touched&&r.form.controls.title.invalid),t.R7$(25),t.Y8G("ngForOf",r.users),t.R7$(7),t.Y8G("ngIf",r.error),t.R7$(),t.Y8G("ngIf",r.success))},dependencies:[d.Sq,d.bT,a.qT,a.me,a.BC,a.cb,a.j4,a.JD]})}}return n})();function v(n,l){const[e,i]=l.split(":").map(Number),r=new Date(n);return r.setHours(e,i,0,0),`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}T${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}:00`}function j(n,l){1&n&&(t.j41(0,"div",4),t.EFF(1,"No meetings."),t.k0s())}function E(n,l){if(1&n&&(t.j41(0,"p",18),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.SpI("\u{1f4cd} ",e.location,"")}}function T(n,l){if(1&n&&(t.j41(0,"a",19),t.EFF(1," Join link "),t.k0s()),2&n){const e=t.XpG().$implicit;t.Y8G("href",e.onlineLink,t.B4B)}}function R(n,l){if(1&n&&(t.j41(0,"p",20),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.description)}}function D(n,l){if(1&n){const e=t.RV6();t.j41(0,"li",7)(1,"div",8)(2,"div")(3,"p",9),t.EFF(4),t.j41(5,"span",10),t.EFF(6),t.k0s()(),t.j41(7,"p",11),t.EFF(8),t.nI1(9,"date"),t.nI1(10,"date"),t.k0s(),t.DNE(11,E,2,1,"p",12)(12,T,2,1,"a",13),t.j41(13,"p",14),t.EFF(14),t.k0s()(),t.j41(15,"div",15)(16,"button",16),t.bIt("click",function(){const r=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.cancel(r))}),t.EFF(17," Cancel "),t.k0s()()(),t.DNE(18,R,2,1,"p",17),t.k0s()}if(2&n){const e=l.$implicit;t.R7$(4),t.SpI(" ",e.title," "),t.R7$(),t.AVh("bg-green-100","scheduled"===e.status)("text-green-800","scheduled"===e.status)("bg-gray-200","cancelled"===e.status)("text-gray-800","cancelled"===e.status),t.R7$(),t.SpI(" ",e.status," "),t.R7$(2),t.Lme(" ",t.i5U(9,17,e.start,"medium")," \u2013 ",t.i5U(10,20,e.end,"shortTime")," "),t.R7$(3),t.Y8G("ngIf",e.location),t.R7$(),t.Y8G("ngIf",e.onlineLink),t.R7$(2),t.SpI(" With: ",e.participants.join(", ")," "),t.R7$(2),t.Y8G("disabled","scheduled"!==e.status),t.R7$(2),t.Y8G("ngIf",e.description)}}function G(n,l){if(1&n&&(t.j41(0,"ul",5),t.DNE(1,D,19,23,"li",6),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.meetings)}}let M=(()=>{class n{constructor(e){this.scheduler=e,this.title="Meetings",this.meetings=[],this.refresh=new t.bkB}cancel(e){if(!confirm(`Cancel meeting "${e.title}"?`))return;const r=this.scheduler.cancel(e.id);r.ok?this.refresh.emit():alert(r.error||"Failed to cancel.")}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(h))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-meeting-list"]],inputs:{title:"title",meetings:"meetings"},outputs:{refresh:"refresh"},decls:5,vars:3,consts:[[1,"rounded-xl","border","p-4"],[1,"text-lg","font-semibold","mb-3"],["class","text-sm text-gray-600",4,"ngIf"],["class","space-y-3",4,"ngIf"],[1,"text-sm","text-gray-600"],[1,"space-y-3"],["class","border rounded-lg p-3",4,"ngFor","ngForOf"],[1,"border","rounded-lg","p-3"],[1,"flex","items-center","justify-between"],[1,"font-medium"],[1,"text-xs","ml-2","px-2","py-0.5","rounded-full"],[1,"text-xs","text-gray-500"],["class","text-xs text-gray-600",4,"ngIf"],["target","_blank","rel","noopener","class","text-xs underline",3,"href",4,"ngIf"],[1,"text-xs","text-gray-600","mt-1"],[1,"flex","items-center","gap-2"],["type","button",1,"rounded-lg","border","px-3","py-1","text-sm","hover:bg-gray-50",3,"click","disabled"],["class","text-sm mt-2",4,"ngIf"],[1,"text-xs","text-gray-600"],["target","_blank","rel","noopener",1,"text-xs","underline",3,"href"],[1,"text-sm","mt-2"]],template:function(i,r){1&i&&(t.j41(0,"div",0)(1,"h2",1),t.EFF(2),t.k0s(),t.DNE(3,j,2,0,"div",2)(4,G,2,1,"ul",3),t.k0s()),2&i&&(t.R7$(2),t.JRh(r.title),t.R7$(),t.Y8G("ngIf",!r.meetings.length),t.R7$(),t.Y8G("ngIf",r.meetings.length))},dependencies:[d.Sq,d.bT,d.vh]})}}return n})();function w(n,l){1&n&&(t.j41(0,"div",9),t.EFF(1,"No upcoming meetings."),t.k0s())}function N(n,l){if(1&n&&(t.j41(0,"p",17),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.SpI("\u{1f4cd} ",e.location,"")}}function Y(n,l){if(1&n&&(t.j41(0,"a",18),t.EFF(1," Join link "),t.k0s()),2&n){const e=t.XpG().$implicit;t.Y8G("href",e.onlineLink,t.B4B)}}function U(n,l){if(1&n&&(t.j41(0,"li",12)(1,"p",13),t.EFF(2),t.k0s(),t.j41(3,"p",14),t.EFF(4),t.nI1(5,"date"),t.nI1(6,"date"),t.k0s(),t.DNE(7,N,2,1,"p",15)(8,Y,2,1,"a",16),t.k0s()),2&n){const e=l.$implicit;t.R7$(2),t.JRh(e.title),t.R7$(2),t.Lme(" ",t.i5U(5,5,e.start,"medium")," \u2013 ",t.i5U(6,8,e.end,"shortTime")," "),t.R7$(3),t.Y8G("ngIf",e.location),t.R7$(),t.Y8G("ngIf",e.onlineLink)}}function L(n,l){if(1&n&&(t.j41(0,"ul",10),t.DNE(1,U,9,11,"li",11),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.upcoming)}}let X=(()=>{class n{constructor(e,i){this.auth=e,this.scheduler=i,this.user=null,this.upcoming=[],this.meetingsForMe=[]}ngOnInit(){this.auth.user$.subscribe(e=>{this.user=e,this.reload()})}reload(){if(!this.user)return this.upcoming=[],void(this.meetingsForMe=[]);this.upcoming=this.scheduler.upcomingForUser(this.user.email,8),this.meetingsForMe=this.scheduler.listForUser(this.user.email)}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(_.u),t.rXU(h))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-scheduler"]],decls:11,vars:4,consts:[[1,"mx-auto","max-w-7xl","p-6","grid","gap-6","lg:grid-cols-3"],[1,"lg:col-span-2","space-y-6"],[1,"text-2xl","font-semibold"],[3,"created","updated"],[3,"refresh","title","meetings"],[1,"space-y-4"],[1,"text-lg","font-semibold"],["class","text-sm text-gray-600",4,"ngIf"],["class","space-y-3",4,"ngIf"],[1,"text-sm","text-gray-600"],[1,"space-y-3"],["class","border rounded-lg p-3",4,"ngFor","ngForOf"],[1,"border","rounded-lg","p-3"],[1,"font-medium"],[1,"text-xs","text-gray-500"],["class","text-xs text-gray-600",4,"ngIf"],["target","_blank","rel","noopener","class","text-xs underline",3,"href",4,"ngIf"],[1,"text-xs","text-gray-600"],["target","_blank","rel","noopener",1,"text-xs","underline",3,"href"]],template:function(i,r){1&i&&(t.j41(0,"div",0)(1,"section",1)(2,"h1",2),t.EFF(3,"Scheduler"),t.k0s(),t.j41(4,"app-meeting-form",3),t.bIt("created",function(){return r.reload()})("updated",function(){return r.reload()}),t.k0s(),t.j41(5,"app-meeting-list",4),t.bIt("refresh",function(){return r.reload()}),t.k0s()(),t.j41(6,"aside",5)(7,"h2",6),t.EFF(8,"Upcoming"),t.k0s(),t.DNE(9,w,2,0,"div",7)(10,L,2,1,"ul",8),t.k0s()()),2&i&&(t.R7$(5),t.Y8G("title","My Meetings")("meetings",r.meetingsForMe),t.R7$(4),t.Y8G("ngIf",!r.upcoming.length),t.R7$(),t.Y8G("ngIf",r.upcoming.length))},dependencies:[d.Sq,d.bT,C,M,d.vh]})}}return n})();var O=c(4978),V=c(400);const B=[{path:"",component:X,canActivate:[O.q,V.K],data:{roles:["Admin","Member"]}}];let A=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[f.iI.forChild(B),f.iI]})}}return n})(),J=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[d.MD,a.YN,a.X1,f.iI,A]})}}return n})()}}]);